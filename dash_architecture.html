<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style2.css">
    <link rel="shortcut icon" href="images/copyryt.png">
    <title>Riseonic &mdash;we provide construction practice</title>
</head>

<body>
    <section class="heads">
        <div class="hero-2 overlay" style="background-image: url('images/architect9.jpg');">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-5 mx-auto ">
                        <h1 class="mb-5 text-center"><span>DASHBOARD</span></h1>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="d-flex flex-row-reverse">
                <div class="p-2">
                    <button type="button" class="btn btn-dark">back</button>
                    <button type="button" class="btn btn-dark">log out</button>
                </div>
                <div class="p-2">

                </div>
                <div class="p-2">Flex item 3</div>
            </div>
        </div>
    </section>
    <section>
        <div class="d-flex flex-row mb-3 justify-content-center">
            <div class="p-2">
                <button class="btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">Updates Pages</button>

                <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Risonic</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">

                        <nav class="sidebar">
                            <h2>Dashboard</h2>
                            <ul>
                                <li class="list-group-item border border-0"><a href="#" onclick="showSection('pagesSection')">home page</a></li>
                                <li class="list-group-item border border-0"><a href=" #" id="myLink">about us page</a></li>

                                <li class="list-group-item border border-0"><a href=" #" onclick="showSection('settingsSection')">Service page</a></li>
                                <li class="list-group-item border border-0"><a href=" #" onclick="showSection('pagesSection')">project</a></li>
                                <li class="list-group-item border border-0"><a href=" #" onclick="showSection('imagesSection')">contact</a></li>
                            </ul>
                            <div class="dropdown  mt-3 mx-4">
                                <button class="btn btn-light dropdown-toggle btn-link" type="button" data-bs-toggle="dropdown">
                                    Service
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="dash_architecture.html">Architecture</a></li>
                                    <li><a class="dropdown-item" href="dash_Program_management.html">Program Management</a></li>
                                    <li><a class="dropdown-item" href="dash_project_management.html">Project Management</a></li>
                                    <li><a class="dropdown-item" href="dash_audit.html">Project Audit</a></li>
                                    <li><a class="dropdown-item" href="dash_procurement.php">Procurement Solution</a></li>
                                    <li><a class="dropdown-item" href="dash_asset_management.html">Assert Management</a></li>

                                    <li><a class="dropdown-item" href="dash_property_development.html">Property Development</a></li>
                                    <li><a class="dropdown-item" href="dash_project_finance.html">Project Finance</a></li>
                                    <li><a class="dropdown-item" href="dash_quantity_survey.html">Quantity Surveyt</a></li>
                                    <li><a class="dropdown-item" href="dash_dispute_management.html">Dispute Management</a></li>

                                </ul>
                            </div>
                        </nav>

                    </div>
                </div>
            </div>
            <div class="p-2">Flex item 2</div>
            <div class="p-2">Flex item 3</div>
        </div>

    </section>

    <!--sectiontion procurerement forms-->
    <section>
        <div class="container">
            <div id="editForm">
                <div class="row">
                    <div class="col-md-4 col sm-sm-12">
                        <h2 class="hheadss">Architecture</h2>
                        <form id="contactFrm" style="width: 100%;">

                            <!-- Message input -->
                            <div data-mdb-input-init class="form-outline mb-4">
                                <label class="form-label" for="textInput">Content Pharagrap (optional)</label>
                                <textarea class="form-control" id="textInput" rows="4"></textarea>
                                <button data-mdb-ripple-init type="button" class="btn btn-secondary btn-block mb-1 mt-2">Update Content</button>
                            </div>
                            <div data-mdb-input-init class="form-outline mb-4">
                                <label class="form-label" for="title">Image Title (optional)</label>
                                <input type="text" class="form-control" id="title_name">

                            </div>
                            <div data-mdb-input-init class="form-outline mb-4">
                                <label class="form-label" for="caption">Image caption (optional)</label>
                                <input type="text" class="form-control" id="caption">


                            </div>

                            <div data-mdb-input-init class="form-outline mb-4">
                                <label class="form-label" for="mission">Portfolio Images (optional)</label>
                                <input class="form-control btn-block" id="file" name="file" type="file">
                            </div>

                            <div data-mdb-input-init class="form-outline mb-4">

                                <input type="hidden" class="form-control btn-block" id="gallerytype" name="gallerytype" value="architecture" disabled>
                            </div>
                            <!-- Submit button -->
                            <button data-mdb-ripple-init type="button" onclick="uploadImages()" class="btn btn-secondary btn-block mb-4">Update</button>
                            <button data-mdb-ripple-init type="button" class="btn btn-secondary btn-block mb-4">Cancel

                            </button>
                        </form>
                    </div>
                    <div class="col-md-8 col-sm-12">
                        <iframe src="propert_assert_management.html" class="m-0" height="500" width="650" title="Iframe Example"></iframe>

                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--sectiontion procurerement forms end of-->
    <!--start section portfolio-->
    <section>
        <div class="container my-4">

            <h1 class="hheadss">PORTFOLIO</h1>
            <div class="row mt-5" id="image-grid">
                <!-- Images will be dynamically inserted here -->
            </div>

        </div>

        <!-- Modal for updating image -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Update Image</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="updateForm">
            <input type="hidden" id="imageId">
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input type="text" class="form-control" id="title">
            </div>
            <div class="mb-3">
              <label for="img_caption" class="form-label">Name..</label>
              <input type="text" class="form-control" id="img_caption">
            </div>
            <div class="mb-3">
              <label for="imageSrc" class="form-label">Source</label>
              <input type="text" class="form-control" id="img_src" disabled>
            </div>
            <div data-mdb-input-init class="form-outline mb-4">
              <label class="form-label" for="updatefile">Portfolio Images (optional)</label>
              <input class="form-control btn-block" id="updatefile" name="updatefile" type="file">
          </div>
            <button type="submit" class="btn btn-primary">Update Image</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
    </section>
    <!--start section portfolio-->



    <script src="js/jquery.min.js"></script>

    <script src="js/dashboard.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
</head>

    <script>
        function uploadImages() {

            var formData = new FormData(); //get form element object
            var fileUpload = $('#file').get(0); //get attribute ellement
            var files = fileUpload.files[0]; //this array get file name and size

            if (files) {

                formData.append('file', files); // Append the file to FormData object
                formData.append('action', 'uploadProc');
                formData.append('caption', $('#caption').val());
                formData.append('title_name', $('#title_name').val());
                formData.append('gallerytype', $('#gallerytype').val());



                console.log(formData);
                // Perform AJAX request to upload file
                $.ajax({
                    url: 'backend/api.php', // URL to which the request is sent
                    type: 'POST', // Type of request
                    data: formData, // FormData object
                    contentType: false, // Prevent jQuery from setting Content-Type
                    processData: false, // Prevent jQuery from processing data
                    success: function(response) {
                        console.log('File uploaded successfully:', response);

                        $("#contactFrm")[0].reset();
                        alert('photo inserted');
                        loadImages();
                    },
                    error: function(xhr, status, error) {
                        console.error('Upload failed:', status, error);
                    }
                });
            } else {
                console.error('No file selected');
            }
        }

        //end of function upload

        //update images


        // Function to load images via AJAX
        function loadImages() {
            $.ajax({
                url: 'backend/testGet.php',
                type: 'GET',
                data: {
                    action: 'architectFront'
                },
                success: function(response) {
                    const images = JSON.parse(response);
                    let imageGrid = $('#image-grid');
                    imageGrid.empty(); // Clear the grid

                    // Loop through the images and add them to the grid
                    images.forEach(function(image) {
                        const imageDiv = `
                       <div class="col-md-4">
                        <div class="card mb-4">
                            <img src="${image.img_src}" class="card-img-top" alt="${image.img_title}">
                            <div class="card-body">
                                <h5 class="card-title">${image.img_title}</h5>
                                <p class="card-text">${image.img_caption}</p>
                                <button class="btn btn-warning update-btn btn-sm" data-id="${image.image_id}" data-title="${image.img_title}" data-name="${image.img_caption}" data-src="${image.img_src}">Update</button>
                                <button type="submit" id="btnDel" class="btn btn-danger btn-sm delete-btn" onclick="fetchImages();loadImages();">Delete</button>
 
                            </div>
                        </div>
                    </div>
                    `;
                        imageGrid.append(imageDiv);
                    });
                }
            });
        }

         // Bind the click event to the update buttons
        $(document).on('click', '.update-btn', function() {
    const id = $(this).data('id');
    const title = $(this).data('title');
    const name = $(this).data('name');
    const src = $(this).data('src');
    
    $('#imageId').val(id);
    $('#title').val(title); // Change IDs accordingly
    $('#img_caption').val(name);
    $('#img_src').val(src);

    $('#updateModal').modal('show');
});
    

// Handle the form submission for updating an image
$('#updateForm').on('submit', function(e) {
        e.preventDefault();

        var formData = new FormData();
        var fileUpload = $('#updatefile').get(0);
        var files = fileUpload.files[0];

        if (files) {
            formData.append('file', files);
        }
        formData.append('action', 'update');
        formData.append('imageId', parseInt($('#imageId').val()));
        formData.append('title', $('#title').val());
        formData.append('img_caption', $('#img_caption').val());


        $.ajax({
            url: 'backend/updating.php',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(response) {
                const result = JSON.parse(response);
                if (result.status === 'success') {
                    alert(result.message);
                    $('#updateModal').modal('hide');
                    $('#updateForm')[0].reset();
                    loadImages();
                } else {
                    alert(result.message);
                }
            }
        });
    });

        //stating the delete function
        function fetchImages() {
            // Collect form data in array
            var formData = {
                image_id: $('#imageId').val(),
                action: 'delete' // Action to perform in PHP function call
            };

            console.log('Array:', formData);
            // Perform an AJAX request to the PHP script
            $.ajax({
                url: 'backend/api.php', // URL to the PHP script
                method: 'POST', // Use POST method
                data: formData, // Send form data
                dataType: 'json',
                success: function(response) {

                    // Handle the response


                },

            });
        }

        // On document ready, load the images
        $(document).ready(function() {
            loadImages();

            // Update images when the button is clicked
            $('#btnDel').on('click', function() {
                loadImages(); // Reload images

            });
        });
    </script>

</body>

</html>